<!DOCTYPE html>
<html>

<head>
  <title>P5 test</title>
  <meta http-equiv="pragma" content="no-cache" />
  <meta http-equiv="cache-control" content="no-cache" />
  <meta charset="utf-8">

  <style>
    body {
      margin: 0;
      overflow: hidden;
    }
  </style>
</head>

<body>
  <script type="module">
    import p5 from '../src/app.js';

    const sketch = function (p) {
      let myShader
      let tex
      p.setup = function () {
        p.createCanvas(20, 10, p.WEBGL);
        p.background(255);

        myShader = p.baseMaterialShader().modify({
          uniforms: {
            'sampler2D myTex': undefined,
          },
          'Inputs getPixelInputs': `(Inputs inputs) {
            inputs.color = texture(myTex, inputs.texCoord);
            return inputs;
          }`
        })

        // Make a red texture
        tex = p.createFramebuffer();
        tex.draw(() => p.background('red'));

        p.translate(-p.width/2, -p.height/2)
        p.shader(myShader);
        p.noStroke();
        myShader.setUniform('myTex', tex);

        // Draw once to the left
        p.rect(0, 0, 10, 10);

        // Draw once to the right
        p.rect(10, 0, 10, 10);
        console.log(p.canvas.toDataURL())
      };
    };

    new p5(sketch);
  </script>
</body>

</html>